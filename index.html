<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Year Countdown</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f7;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #0071e3;
            --accent-secondary: #147ce5;
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.1);
            --particle-color: rgba(0, 113, 227, 0.3);
        }

        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #1d1d1f;
            --text-primary: #f5f5f7;
            --text-secondary: #86868b;
            --accent: #2997ff;
            --accent-secondary: #0077ed;
            --card-bg: rgba(29, 29, 31, 0.8);
            --card-border: rgba(255, 255, 255, 0.1);
            --particle-color: rgba(41, 151, 255, 0.3);
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-bottom: 15vh;
            background: var(--bg-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Controls Menu */
        .controls-menu {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 20;
        }

        .menu-trigger {
            width: 44px;
            height: 44px;
            background: var(--bg-secondary);
            border-radius: 50%;
            border: 1px solid var(--card-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .menu-trigger:hover {
            transform: scale(1.05);
            background: var(--accent);
            color: #fff;
        }

        .menu-trigger svg {
            display: block;
            transition: transform 0.3s ease;
        }

        .controls-menu:hover .menu-trigger svg,
        .controls-menu.open .menu-trigger svg {
            transform: rotate(90deg);
        }

        .menu-panel {
            position: absolute;
            top: 54px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--card-border);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .controls-menu:hover .menu-panel,
        .controls-menu.open .menu-panel {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-row {
            display: flex;
            gap: 0.5rem;
        }

        /* Theme toggle inside menu */
        .theme-toggle {
            width: 70px;
            height: 36px;
            background: var(--card-bg);
            border-radius: 18px;
            border: 1px solid var(--card-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
        }

        .toggle-icon {
            font-size: 16px;
            z-index: 1;
            transition: opacity 0.3s ease;
        }

        .sun-icon {
            opacity: 1;
        }

        .moon-icon {
            opacity: 0.4;
        }

        [data-theme="dark"] .sun-icon {
            opacity: 0.4;
        }

        [data-theme="dark"] .moon-icon {
            opacity: 1;
        }

        .toggle-thumb {
            position: absolute;
            left: 4px;
            width: 28px;
            height: 28px;
            background: var(--accent);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        [data-theme="dark"] .toggle-thumb {
            transform: translateX(34px);
        }

        /* Language toggle inside menu */
        .lang-toggle {
            height: 36px;
            background: var(--card-bg);
            border-radius: 18px;
            border: 1px solid var(--card-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
            gap: 0;
            transition: all 0.3s ease;
            width: 100%;
        }

        .lang-toggle:hover {
            transform: scale(1.05);
        }

        .lang-option {
            padding: 0 12px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 14px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .lang-option.active {
            background: var(--accent);
            color: #fff;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            letter-spacing: -0.02em;
        }

        .main-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 3rem;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .countdown {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .time-box {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem 2.5rem;
            min-width: 130px;
            text-align: center;
            border: 1px solid var(--card-border);
            animation: float 4s ease-in-out infinite;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .time-box:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .time-box:nth-child(1) { animation-delay: 0s; }
        .time-box:nth-child(2) { animation-delay: 0.15s; }
        .time-box:nth-child(3) { animation-delay: 0.3s; }
        .time-box:nth-child(4) { animation-delay: 0.45s; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .time-box:hover {
            animation-play-state: paused;
        }

        .number {
            font-size: 3.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
            transition: color 0.3s ease;
        }

        .label {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }


        .city-skyline {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 180px;
            pointer-events: none;
            z-index: 1;
        }

        .city-skyline svg {
            width: 100%;
            height: 100%;
            transition: opacity 0.3s ease;
        }

        /* Building silhouettes */
        .city-skyline .buildings {
            fill: var(--text-primary);
            opacity: 0.08;
            transition: opacity 0.3s ease;
        }

        [data-theme="dark"] .city-skyline .buildings {
            opacity: 0.15;
        }

        .city-skyline.lit .buildings {
            opacity: 0.25;
        }

        [data-theme="dark"] .city-skyline.lit .buildings {
            opacity: 0.4;
        }

        /* SVG window lights */
        .svg-windows .window {
            fill: #ffeeaa;
            opacity: 0;
        }

        [data-theme="dark"] .svg-windows .window {
            opacity: 1;
            fill: #ffdd66;
            animation: svgTwinkle 3s ease-in-out infinite;
        }

        @keyframes svgTwinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Stagger animations */
        .svg-windows .window:nth-child(odd) { animation-delay: 0s; }
        .svg-windows .window:nth-child(even) { animation-delay: 1.5s; }
        .svg-windows .window:nth-child(3n) { animation-delay: 0.7s; }

        /* Lit state during fireworks - colorful pulsating windows */
        .city-skyline.lit .svg-windows .window {
            opacity: 1 !important;
            animation: windowPulse 0.8s ease-in-out infinite !important;
        }

        /* Stagger the pulse colors across windows - warm tones with occasional cool accent */
        .city-skyline.lit .svg-windows .window:nth-child(7n+1) { animation-delay: 0s !important; --pulse-color-1: #ffee55; --pulse-color-2: #ffaa00; }
        .city-skyline.lit .svg-windows .window:nth-child(7n+2) { animation-delay: 0.1s !important; --pulse-color-1: #ff8833; --pulse-color-2: #ff5522; }
        .city-skyline.lit .svg-windows .window:nth-child(7n+3) { animation-delay: 0.2s !important; --pulse-color-1: #ffffcc; --pulse-color-2: #ffdd44; }
        .city-skyline.lit .svg-windows .window:nth-child(7n+4) { animation-delay: 0.3s !important; --pulse-color-1: #ff6644; --pulse-color-2: #ffaa33; }
        .city-skyline.lit .svg-windows .window:nth-child(7n+5) { animation-delay: 0.4s !important; --pulse-color-1: #ffcc22; --pulse-color-2: #ff7744; }
        .city-skyline.lit .svg-windows .window:nth-child(7n+6) { animation-delay: 0.5s !important; --pulse-color-1: #aa88ff; --pulse-color-2: #ffbb55; }
        .city-skyline.lit .svg-windows .window:nth-child(7n) { animation-delay: 0.6s !important; --pulse-color-1: #ffbb44; --pulse-color-2: #6699ff; }

        @keyframes windowPulse {
            0%, 100% {
                fill: var(--pulse-color-1, #ff4477);
                opacity: 1;
                filter: drop-shadow(0 0 4px var(--pulse-color-1, #ff4477));
            }
            50% {
                fill: var(--pulse-color-2, #ffaa00);
                opacity: 0.8;
                filter: drop-shadow(0 0 8px var(--pulse-color-2, #ffaa00));
            }
        }

        .city-lights {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 180px;
            pointer-events: none;
            z-index: 2;
        }

        /* Street lights on poles */
        .street-light {
            position: absolute;
            bottom: 4.5%;
            width: 6px;
            height: 6px;
            background: #ffeebb;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 8px #ffdd88, 0 0 15px rgba(255, 220, 130, 0.5);
        }

        .street-light::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 18px;
            background: var(--text-primary);
            opacity: 0.15;
        }

        .street-light::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 15px;
            background: radial-gradient(ellipse at top, rgba(255, 220, 130, 0.3) 0%, transparent 70%);
            opacity: 0;
        }

        [data-theme="dark"] .street-light {
            opacity: 0.9;
            box-shadow: 0 0 10px #ffdd88, 0 0 20px rgba(255, 220, 130, 0.6);
        }

        [data-theme="dark"] .street-light::before {
            opacity: 0.25;
        }

        [data-theme="dark"] .street-light::after {
            opacity: 1;
        }

        .city-lights.lit .street-light {
            opacity: 1;
            box-shadow: 0 0 12px #ffee99, 0 0 25px rgba(255, 230, 150, 0.8);
        }

        .city-lights.lit .street-light::after {
            opacity: 1;
            background: radial-gradient(ellipse at top, rgba(255, 230, 150, 0.5) 0%, transparent 70%);
        }

        /* Night sky with moon and stars */
        .night-sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .night-sky.visible {
            opacity: 1;
        }

        /* Aurora - GPU optimized, single element with animated gradients */
        .aurora {
            position: absolute;
            top: -20%;
            left: -10%;
            width: 120%;
            height: 80%;
            opacity: 0;
            transition: opacity 3s ease;
            pointer-events: none;
            background:
                /* Curtain folds - vertical bands */
                linear-gradient(90deg,
                    transparent 0%,
                    rgba(0, 255, 150, 0.2) 10%,
                    transparent 20%,
                    rgba(0, 220, 200, 0.25) 35%,
                    transparent 45%,
                    rgba(100, 255, 180, 0.2) 60%,
                    transparent 70%,
                    rgba(0, 200, 255, 0.25) 85%,
                    transparent 100%
                ),
                /* Base color */
                linear-gradient(180deg,
                    rgba(0, 200, 180, 0.06) 0%,
                    rgba(0, 220, 255, 0.08) 30%,
                    rgba(100, 150, 255, 0.06) 60%,
                    rgba(150, 100, 255, 0.04) 100%
                );
            background-size: 200% 100%, 100% 100%;
            /* Mask fades out the entire element smoothly */
            -webkit-mask-image: linear-gradient(180deg,
                transparent 0%,
                black 15%,
                black 35%,
                transparent 70%
            );
            mask-image: linear-gradient(180deg,
                transparent 0%,
                black 15%,
                black 35%,
                transparent 70%
            );
            will-change: background-position, opacity;
        }

        .night-sky.aurora-visible .aurora {
            opacity: 1;
            animation: auroraDrift 60s ease-in-out infinite, auroraPulse 15s ease-in-out infinite;
        }

        @keyframes auroraDrift {
            0%, 100% {
                background-position: 0% 0%, 0% 0%;
                transform: translateY(0) scaleY(1);
            }
            50% {
                background-position: 100% 0%, 0% 0%;
                transform: translateY(2%) scaleY(1.03);
            }
        }

        @keyframes auroraPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .moon {
            position: absolute;
            top: 8%;
            left: 8%;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 35% 35%, #fffef0 0%, #fff9c4 50%, #ffecb3 100%);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 249, 196, 0.5), 0 0 60px rgba(255, 236, 179, 0.3), 0 0 100px rgba(255, 236, 179, 0.2);
        }

        .moon::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 15%;
            width: 12px;
            height: 12px;
            background: rgba(200, 190, 150, 0.3);
            border-radius: 50%;
        }

        .moon::after {
            content: '';
            position: absolute;
            top: 40%;
            left: 55%;
            width: 8px;
            height: 8px;
            background: rgba(200, 190, 150, 0.2);
            border-radius: 50%;
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        [data-theme="dark"] .star {
            opacity: 1;
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .moon {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        [data-theme="dark"] .moon {
            opacity: 1;
        }

        /* Cozy warm glow at the bottom */
        .city-glow {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: linear-gradient(to top, rgba(255, 200, 100, 0.08) 0%, transparent 100%);
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        [data-theme="dark"] .city-glow {
            background: linear-gradient(to top, rgba(255, 180, 80, 0.15) 0%, transparent 100%);
        }

        .city-glow.visible {
            opacity: 1;
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .firework {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: explode 1.5s ease-out forwards;
            filter: blur(0.5px);
        }

        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .spark {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: spark 1.4s ease-out forwards;
            box-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
        }

        @keyframes spark {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            70% { opacity: 0.8; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
        }

        .spark-trail {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: sparkTrail 0.8s ease-out forwards;
            opacity: 0.6;
        }

        @keyframes sparkTrail {
            0% { transform: translate(0, 0) scale(1); opacity: 0.6; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
        }

        .ring {
            position: absolute;
            border-radius: 50%;
            border: 3px solid;
            animation: ring 1.2s ease-out forwards;
            box-shadow: 0 0 20px currentColor, inset 0 0 20px currentColor;
        }

        @keyframes ring {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 150px; height: 150px; opacity: 0; margin-left: -75px; margin-top: -75px; }
        }

        .starburst {
            position: absolute;
            width: 6px;
            height: 20px;
            animation: starburst 1s ease-out forwards;
            transform-origin: center bottom;
        }

        @keyframes starburst {
            0% { transform: rotate(var(--angle)) translateY(0) scaleY(0); opacity: 1; }
            30% { transform: rotate(var(--angle)) translateY(-60px) scaleY(1); opacity: 1; }
            100% { transform: rotate(var(--angle)) translateY(-120px) scaleY(0.3); opacity: 0; }
        }

        .glitter {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: glitter 2s ease-out forwards;
            box-shadow: 0 0 4px currentColor;
        }

        @keyframes glitter {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            25% { opacity: 0.3; }
            50% { opacity: 1; }
            75% { opacity: 0.3; }
            100% { transform: translate(var(--dx), calc(var(--dy) + 100px)) scale(0); opacity: 0; }
        }

        .rocket {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: rocket var(--duration) ease-out forwards;
            box-shadow: 0 0 10px currentColor, 0 10px 20px currentColor;
        }

        @keyframes rocket {
            0% { transform: translateY(0); opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(var(--travel)); opacity: 0; }
        }

        .rocket-trail {
            position: absolute;
            width: 3px;
            height: 30px;
            background: linear-gradient(to top, transparent, currentColor);
            animation: rocketTrail var(--duration) ease-out forwards;
            opacity: 0.5;
        }

        @keyframes rocketTrail {
            0% { transform: translateY(0); opacity: 0.5; height: 0; }
            50% { height: 40px; opacity: 0.5; }
            100% { transform: translateY(var(--travel)); opacity: 0; height: 20px; }
        }

        /* Mute toggle inside menu */
        .mute-toggle {
            width: 36px;
            height: 36px;
            background: var(--card-bg);
            border-radius: 50%;
            border: 1px solid var(--card-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
            color: var(--text-secondary);
            align-self: center;
        }

        .mute-toggle svg {
            display: block;
        }

        .mute-toggle:hover {
            transform: scale(1.05);
            background: var(--accent);
            color: #fff;
        }

        .mute-toggle .sound-on {
            display: block;
        }

        .mute-toggle .sound-off {
            display: none;
        }

        .mute-toggle.muted .sound-on {
            display: none;
        }

        .mute-toggle.muted .sound-off {
            display: block;
        }

        /* Fireworks button inside menu */
        .fireworks-btn {
            padding: 0.5rem 1rem;
            height: 36px;
            font-size: 0.75rem;
            font-weight: 600;
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 1px solid var(--card-border);
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            white-space: nowrap;
            width: 100%;
        }

        .fireworks-btn:hover {
            transform: scale(1.05);
            background: var(--accent);
            color: #fff;
        }

        .fireworks-btn:active {
            transform: scale(0.98);
        }

        @media (max-width: 600px) {
            .main-title { font-size: 2.5rem; }
            .countdown { gap: 0.75rem; }
            .time-box { padding: 1rem 1.25rem; min-width: 70px; }
            .number { font-size: 2.5rem; }
            .city-skyline { height: 120px; }
            .city-lights { height: 120px; }
            .controls-menu { top: 1rem; right: 1rem; }
            .city-skyline .hide-mobile { display: none; }
            .street-light::before { height: 12px; bottom: -5px; }
        }

        /* Touch device - disable hover, use tap */
        @media (hover: none) {
            .controls-menu:hover .menu-panel {
                opacity: 0;
                visibility: hidden;
                transform: translateY(-10px);
            }
            .controls-menu.open .menu-panel {
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="night-sky" id="nightSky">
        <div class="aurora"></div>
        <div class="moon"></div>
    </div>
    <div class="city-glow" id="cityGlow"></div>

    <div class="controls-menu" id="controlsMenu">
        <button class="menu-trigger" id="menuTrigger" aria-label="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </button>
        <div class="menu-panel">
            <button class="fireworks-btn" id="fireworksBtn">Fireworks</button>
            <div class="menu-row">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <span class="toggle-icon sun-icon">&#9728;</span>
                    <span class="toggle-icon moon-icon">&#9790;</span>
                    <div class="toggle-thumb"></div>
                </button>
                <button class="mute-toggle" id="muteToggle" aria-label="Toggle sound">
                    <svg class="sound-on" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                    </svg>
                    <svg class="sound-off" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <line x1="23" y1="9" x2="17" y2="15"></line>
                        <line x1="17" y1="9" x2="23" y2="15"></line>
                    </svg>
                </button>
            </div>
            <div class="lang-toggle" id="langToggle">
                <span class="lang-option active" data-lang="en">EN</span>
                <span class="lang-option" data-lang="ro">RO</span>
            </div>
        </div>
    </div>

    <h1 id="subtitle">Countdown to</h1>
    <div class="main-title" id="mainTitle">New Year 2026</div>

    <div class="countdown">
        <div class="time-box">
            <div class="number" id="days">000</div>
            <div class="label" id="labelDays">Days</div>
        </div>
        <div class="time-box">
            <div class="number" id="hours">00</div>
            <div class="label" id="labelHours">Hours</div>
        </div>
        <div class="time-box">
            <div class="number" id="minutes">00</div>
            <div class="label" id="labelMinutes">Minutes</div>
        </div>
        <div class="time-box">
            <div class="number" id="seconds">00</div>
            <div class="label" id="labelSeconds">Seconds</div>
        </div>
    </div>

    <div class="city-skyline" id="citySkyline">
        <svg viewBox="0 0 1200 180" preserveAspectRatio="xMidYMax slice">
            <defs>
                <filter id="windowGlow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="2" result="glow"/>
                    <feMerge>
                        <feMergeNode in="glow"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
            <!-- Hogwarts Castle silhouette -->
            <g class="buildings">

            <!-- Far left towers (hide on mobile) -->
            <g class="hide-mobile">
                <!-- Small tower -->
                <rect x="0" y="120" width="25" height="60"/>
                <polygon points="0,120 12,85 25,120"/>
                <rect x="8" y="90" width="8" height="30"/>
                <!-- Medium tower -->
                <rect x="35" y="100" width="30" height="80"/>
                <polygon points="35,100 50,60 65,100"/>
                <rect x="45" y="65" width="10" height="35"/>
                <!-- Connecting wall -->
                <rect x="65" y="140" width="40" height="40"/>
                <rect x="70" y="135" width="8" height="10"/>
                <rect x="85" y="135" width="8" height="10"/>
                <rect x="100" y="135" width="8" height="10"/>
            </g>

            <!-- West wing towers -->
            <g class="hide-mobile">
                <rect x="110" y="90" width="35" height="90"/>
                <polygon points="110,90 127,45 145,90"/>
                <rect x="122" y="50" width="10" height="40"/>
                <!-- Small turret -->
                <rect x="150" y="110" width="20" height="70"/>
                <polygon points="150,110 160,80 170,110"/>
            </g>

            <!-- Great Hall section -->
            <g>
                <!-- Main hall body -->
                <rect x="180" y="95" width="120" height="85"/>
                <!-- Peaked roof -->
                <polygon points="175,95 240,50 305,95"/>
                <!-- Roof spire -->
                <rect x="235" y="30" width="10" height="25"/>
                <polygon points="235,30 240,15 245,30"/>
                <!-- Buttresses -->
                <polygon points="175,130 180,95 180,130"/>
                <polygon points="305,130 300,95 300,130"/>
            </g>

            <!-- Central castle - main towers -->
            <g>
                <!-- Left main tower -->
                <rect x="310" y="70" width="40" height="110"/>
                <polygon points="310,70 330,25 350,70"/>
                <rect x="325" y="30" width="10" height="40"/>
                <!-- Battlements -->
                <rect x="312" y="65" width="8" height="8"/>
                <rect x="328" y="65" width="8" height="8"/>
                <rect x="340" y="65" width="8" height="8"/>
            </g>

            <!-- Central keep -->
            <g>
                <rect x="355" y="85" width="90" height="95"/>
                <polygon points="355,85 400,55 445,85"/>
                <!-- Central tower on keep -->
                <rect x="385" y="40" width="30" height="50"/>
                <polygon points="385,40 400,10 415,40"/>
                <rect x="395" y="15" width="10" height="25"/>
            </g>

            <!-- Right main tower -->
            <g>
                <rect x="450" y="75" width="35" height="105"/>
                <polygon points="450,75 467,30 485,75"/>
                <rect x="462" y="35" width="10" height="40"/>
                <!-- Battlements -->
                <rect x="452" y="70" width="7" height="8"/>
                <rect x="464" y="70" width="7" height="8"/>
                <rect x="476" y="70" width="7" height="8"/>
            </g>

            <!-- Astronomy Tower (tallest) -->
            <g>
                <rect x="495" y="50" width="30" height="130"/>
                <polygon points="495,50 510,5 525,50"/>
                <rect x="505" y="10" width="10" height="40"/>
                <!-- Observation deck -->
                <rect x="490" y="55" width="40" height="10"/>
                <!-- Small windows going up -->
                <rect x="507" y="65" width="6" height="8" fill-opacity="0.3"/>
                <rect x="507" y="85" width="6" height="8" fill-opacity="0.3"/>
                <rect x="507" y="105" width="6" height="8" fill-opacity="0.3"/>
            </g>

            <!-- Eastern wing -->
            <g>
                <rect x="535" y="100" width="80" height="80"/>
                <polygon points="535,100 575,65 615,100"/>
                <!-- Twin small spires -->
                <rect x="550" y="70" width="12" height="30"/>
                <polygon points="550,70 556,50 562,70"/>
                <rect x="588" y="70" width="12" height="30"/>
                <polygon points="588,70 594,50 600,70"/>
            </g>

            <!-- Bridge/covered walkway -->
            <g>
                <rect x="620" y="130" width="60" height="50"/>
                <rect x="620" y="125" width="60" height="8"/>
                <!-- Arches -->
                <ellipse cx="635" cy="160" rx="10" ry="12" fill-opacity="0.3"/>
                <ellipse cx="665" cy="160" rx="10" ry="12" fill-opacity="0.3"/>
            </g>

            <!-- Eastern towers -->
            <g>
                <rect x="685" y="80" width="35" height="100"/>
                <polygon points="685,80 702,40 720,80"/>
                <rect x="697" y="45" width="10" height="35"/>
                <!-- Battlements -->
                <rect x="687" y="75" width="7" height="8"/>
                <rect x="699" y="75" width="7" height="8"/>
                <rect x="711" y="75" width="7" height="8"/>
            </g>

            <!-- Clock tower -->
            <g>
                <rect x="730" y="60" width="30" height="120"/>
                <polygon points="730,60 745,20 760,60"/>
                <rect x="740" y="25" width="10" height="35"/>
                <!-- Clock face -->
                <circle cx="745" cy="90" r="12" fill-opacity="0.3"/>
            </g>

            <!-- Far eastern section -->
            <g>
                <rect x="770" y="95" width="70" height="85"/>
                <polygon points="770,95 805,60 840,95"/>
                <!-- Small tower -->
                <rect x="795" y="50" width="20" height="50"/>
                <polygon points="795,50 805,30 815,50"/>
            </g>

            <!-- East end towers (hide on mobile) -->
            <g class="hide-mobile">
                <rect x="850" y="85" width="30" height="95"/>
                <polygon points="850,85 865,45 880,85"/>
                <rect x="860" y="50" width="10" height="35"/>

                <rect x="890" y="100" width="35" height="80"/>
                <polygon points="890,100 907,65 925,100"/>
                <rect x="902" y="70" width="10" height="30"/>

                <!-- Connecting wall with battlements -->
                <rect x="925" y="130" width="50" height="50"/>
                <rect x="930" y="125" width="8" height="10"/>
                <rect x="945" y="125" width="8" height="10"/>
                <rect x="960" y="125" width="8" height="10"/>
            </g>

            <!-- Far right towers (hide on mobile) -->
            <g class="hide-mobile">
                <rect x="980" y="90" width="30" height="90"/>
                <polygon points="980,90 995,50 1010,90"/>
                <rect x="990" y="55" width="10" height="35"/>

                <rect x="1020" y="105" width="40" height="75"/>
                <polygon points="1020,105 1040,70 1060,105"/>

                <rect x="1070" y="115" width="30" height="65"/>
                <polygon points="1070,115 1085,85 1100,115"/>

                <!-- Final small towers -->
                <rect x="1110" y="125" width="25" height="55"/>
                <polygon points="1110,125 1122,100 1135,125"/>

                <rect x="1145" y="130" width="30" height="50"/>
                <polygon points="1145,130 1160,105 1175,130"/>

                <rect x="1180" y="140" width="20" height="40"/>
                <polygon points="1180,140 1190,120 1200,140"/>
            </g>

            <!-- Ground/rocky foundation -->
            <rect x="0" y="175" width="1200" height="5"/>
            </g><!-- end buildings -->

            <!-- Castle window lights -->
            <g class="svg-windows" filter="url(#windowGlow)">
                <!-- Great Hall windows (x=180-300) - tall arched windows -->
                <rect class="window" x="190" y="105" width="4" height="12"/>
                <rect class="window" x="205" y="105" width="4" height="12"/>
                <rect class="window" x="220" y="105" width="4" height="12"/>
                <rect class="window" x="235" y="105" width="4" height="12"/>
                <rect class="window" x="250" y="105" width="4" height="12"/>
                <rect class="window" x="265" y="105" width="4" height="12"/>
                <rect class="window" x="280" y="105" width="4" height="12"/>
                <!-- Lower windows -->
                <rect class="window" x="195" y="140" width="5" height="7"/>
                <rect class="window" x="220" y="140" width="5" height="7"/>
                <rect class="window" x="245" y="140" width="5" height="7"/>
                <rect class="window" x="270" y="140" width="5" height="7"/>
                <!-- Roof spire window -->
                <rect class="window" x="238" y="35" width="4" height="5"/>

                <!-- Left main tower (x=310-350) -->
                <rect class="window" x="327" y="80" width="4" height="5"/>
                <rect class="window" x="327" y="95" width="4" height="5"/>
                <rect class="window" x="327" y="115" width="4" height="6"/>
                <rect class="window" x="327" y="135" width="4" height="6"/>
                <rect class="window" x="327" y="155" width="4" height="6"/>

                <!-- Central keep (x=355-445) -->
                <rect class="window" x="397" y="50" width="5" height="6"/>
                <rect class="window" x="365" y="95" width="4" height="5"/>
                <rect class="window" x="385" y="95" width="4" height="5"/>
                <rect class="window" x="405" y="95" width="4" height="5"/>
                <rect class="window" x="425" y="95" width="4" height="5"/>
                <rect class="window" x="365" y="115" width="5" height="7"/>
                <rect class="window" x="395" y="115" width="5" height="7"/>
                <rect class="window" x="425" y="115" width="5" height="7"/>
                <rect class="window" x="370" y="145" width="6" height="8"/>
                <rect class="window" x="397" y="145" width="6" height="8"/>
                <rect class="window" x="424" y="145" width="6" height="8"/>

                <!-- Right main tower (x=450-485) -->
                <rect class="window" x="464" y="85" width="4" height="5"/>
                <rect class="window" x="464" y="100" width="4" height="5"/>
                <rect class="window" x="464" y="120" width="4" height="6"/>
                <rect class="window" x="464" y="140" width="4" height="6"/>
                <rect class="window" x="464" y="160" width="4" height="6"/>

                <!-- Astronomy Tower (x=495-525) - windows going up -->
                <rect class="window" x="507" y="25" width="5" height="6"/>
                <rect class="window" x="507" y="125" width="4" height="5"/>
                <rect class="window" x="507" y="145" width="4" height="5"/>
                <rect class="window" x="507" y="160" width="4" height="5"/>

                <!-- Eastern wing (x=535-615) -->
                <rect class="window" x="554" y="75" width="3" height="4"/>
                <rect class="window" x="592" y="75" width="3" height="4"/>
                <rect class="window" x="545" y="110" width="4" height="5"/>
                <rect class="window" x="565" y="110" width="4" height="5"/>
                <rect class="window" x="585" y="110" width="4" height="5"/>
                <rect class="window" x="605" y="110" width="4" height="5"/>
                <rect class="window" x="550" y="135" width="5" height="7"/>
                <rect class="window" x="575" y="135" width="5" height="7"/>
                <rect class="window" x="600" y="135" width="5" height="7"/>

                <!-- Bridge windows (x=620-680) -->
                <rect class="window" x="635" y="140" width="4" height="5"/>
                <rect class="window" x="655" y="140" width="4" height="5"/>

                <!-- Eastern tower (x=685-720) -->
                <rect class="window" x="699" y="90" width="4" height="5"/>
                <rect class="window" x="699" y="110" width="4" height="5"/>
                <rect class="window" x="699" y="130" width="4" height="6"/>
                <rect class="window" x="699" y="155" width="4" height="6"/>

                <!-- Clock tower (x=730-760) -->
                <rect class="window" x="742" y="70" width="4" height="5"/>
                <rect class="window" x="742" y="110" width="4" height="5"/>
                <rect class="window" x="742" y="130" width="4" height="6"/>
                <rect class="window" x="742" y="155" width="4" height="6"/>

                <!-- Far eastern section (x=770-840) -->
                <rect class="window" x="803" y="58" width="4" height="5"/>
                <rect class="window" x="780" y="105" width="4" height="5"/>
                <rect class="window" x="800" y="105" width="4" height="5"/>
                <rect class="window" x="820" y="105" width="4" height="5"/>
                <rect class="window" x="785" y="130" width="5" height="7"/>
                <rect class="window" x="815" y="130" width="5" height="7"/>
                <rect class="window" x="790" y="155" width="5" height="6"/>
                <rect class="window" x="820" y="155" width="5" height="6"/>

                <!-- Far left towers - HIDE ON MOBILE -->
                <g class="hide-mobile">
                    <rect class="window" x="10" y="130" width="3" height="4"/>
                    <rect class="window" x="10" y="145" width="3" height="4"/>
                    <rect class="window" x="47" y="110" width="4" height="5"/>
                    <rect class="window" x="47" y="130" width="4" height="5"/>
                    <rect class="window" x="47" y="150" width="4" height="5"/>
                    <rect class="window" x="124" y="100" width="4" height="5"/>
                    <rect class="window" x="124" y="120" width="4" height="5"/>
                    <rect class="window" x="124" y="145" width="4" height="5"/>
                    <rect class="window" x="157" y="120" width="3" height="4"/>
                    <rect class="window" x="157" y="140" width="3" height="4"/>
                    <rect class="window" x="157" y="160" width="3" height="4"/>
                </g>

                <!-- East end towers - HIDE ON MOBILE -->
                <g class="hide-mobile">
                    <rect class="window" x="862" y="95" width="4" height="5"/>
                    <rect class="window" x="862" y="115" width="4" height="5"/>
                    <rect class="window" x="862" y="140" width="4" height="5"/>
                    <rect class="window" x="905" y="110" width="4" height="5"/>
                    <rect class="window" x="905" y="135" width="4" height="5"/>
                    <rect class="window" x="905" y="155" width="4" height="5"/>
                    <rect class="window" x="992" y="100" width="4" height="5"/>
                    <rect class="window" x="992" y="125" width="4" height="5"/>
                    <rect class="window" x="992" y="150" width="4" height="5"/>
                    <rect class="window" x="1037" y="115" width="4" height="5"/>
                    <rect class="window" x="1037" y="140" width="4" height="5"/>
                    <rect class="window" x="1082" y="125" width="3" height="4"/>
                    <rect class="window" x="1082" y="150" width="3" height="4"/>
                    <rect class="window" x="1120" y="135" width="3" height="4"/>
                    <rect class="window" x="1120" y="155" width="3" height="4"/>
                    <rect class="window" x="1157" y="140" width="3" height="4"/>
                    <rect class="window" x="1157" y="158" width="3" height="4"/>
                </g>
            </g>
        </svg>
    </div>
    <div class="city-lights" id="cityLights"></div>

    <div class="fireworks" id="fireworks"></div>

    <!-- Audio elements -->
    <audio id="audioLoop" loop preload="auto">
        <source src="hedwig_loop.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioClimax" preload="auto">
        <source src="hedwig_climax.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Dynamic year calculation
        const targetYear = new Date().getFullYear() + 1;

        // Audio controls
        const audioLoop = document.getElementById('audioLoop');
        const audioClimax = document.getElementById('audioClimax');
        let audioStarted = false;
        let isMuted = localStorage.getItem('muted') === 'true';

        // Mute toggle
        const muteToggle = document.getElementById('muteToggle');

        function updateMuteState() {
            audioLoop.muted = isMuted;
            audioClimax.muted = isMuted;
            muteToggle.classList.toggle('muted', isMuted);
            localStorage.setItem('muted', isMuted);
        }

        // Initialize mute state
        updateMuteState();

        muteToggle.addEventListener('click', () => {
            isMuted = !isMuted;
            updateMuteState();
        });

        // Menu toggle for mobile (tap to open/close)
        const controlsMenu = document.getElementById('controlsMenu');
        const menuTrigger = document.getElementById('menuTrigger');

        menuTrigger.addEventListener('click', (e) => {
            e.stopPropagation();
            controlsMenu.classList.toggle('open');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!controlsMenu.contains(e.target)) {
                controlsMenu.classList.remove('open');
            }
        });

        function startBackgroundMusic() {
            if (!audioStarted) {
                audioLoop.volume = 0.5;
                audioLoop.play()
                    .then(() => {
                        audioStarted = true;
                    })
                    .catch(() => {
                        // Don't mark as started if play failed - allow retry
                    });
            }
        }

        function playClimaxMusic() {
            // Fade out the loop over 2 seconds
            const fadeOutDuration = 2000;
            const fadeSteps = 30;
            const fadeInterval = fadeOutDuration / fadeSteps;
            const volumeStep = audioLoop.volume / fadeSteps;

            let currentStep = 0;
            const fadeOut = setInterval(() => {
                currentStep++;
                audioLoop.volume = Math.max(0, audioLoop.volume - volumeStep);

                if (currentStep >= fadeSteps) {
                    clearInterval(fadeOut);
                    audioLoop.pause();
                    audioLoop.currentTime = 0;
                    audioLoop.volume = 0.5; // Reset volume for next time
                }
            }, fadeInterval);

            // Start climax with fade in after 1 second delay
            setTimeout(() => {
                audioClimax.currentTime = 0;
                audioClimax.volume = 0;
                audioClimax.play().catch(() => {});

                const fadeInDuration = 2000;
                const fadeInSteps = 30;
                const fadeInInterval = fadeInDuration / fadeInSteps;
                const targetVolume = 0.7;
                const volumeInStep = targetVolume / fadeInSteps;

                let fadeInStep = 0;
                const fadeIn = setInterval(() => {
                    fadeInStep++;
                    audioClimax.volume = Math.min(targetVolume, audioClimax.volume + volumeInStep);

                    if (fadeInStep >= fadeInSteps) {
                        clearInterval(fadeIn);
                        audioClimax.volume = targetVolume;
                    }
                }, fadeInInterval);
            }, 1000);
        }

        // When climax ends, restart the loop
        audioClimax.addEventListener('ended', () => {
            audioLoop.volume = 0.5;
            audioLoop.play().catch(() => {});
        });

        // Fireworks timing constants
        const FIREWORKS_DELAY = 5000;      // 5 seconds delay (syncs with second 4 of climax, accounting for 1s audio delay)
        const FIREWORKS_DURATION = 60000;  // 60 seconds of fireworks

        // Start music on user interaction (required by browsers)
        // Don't use { once: true } - keep trying until music actually starts
        function tryStartMusic(e) {
            startBackgroundMusic();
            if (audioStarted) {
                document.removeEventListener('click', tryStartMusic);
                document.removeEventListener('keydown', tryStartMusic);
            }
        }
        document.addEventListener('click', tryStartMusic);
        document.addEventListener('keydown', tryStartMusic);

        // Create street lights on poles between buildings
        const cityLights = document.getElementById('cityLights');
        const streetLightPositions = [13, 44.5, 60.5, 77.5, 90.5];
        streetLightPositions.forEach(x => {
            const streetLight = document.createElement('div');
            streetLight.className = 'street-light';
            streetLight.style.left = x + '%';
            cityLights.appendChild(streetLight);
        });

        // Create stars for the night sky
        const nightSky = document.getElementById('nightSky');
        for (let i = 0; i < 120; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 60 + '%'; // Keep stars in upper portion
            const size = 1 + Math.random() * 2;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            star.style.animationDelay = Math.random() * 3 + 's';
            nightSky.appendChild(star);
        }

        // Translations
        const translations = {
            en: {
                subtitle: 'Countdown to',
                mainTitle: `New Year ${targetYear}`,
                days: 'Days',
                hours: 'Hours',
                minutes: 'Minutes',
                seconds: 'Seconds',
                happyNewYear: 'Happy New Year!',
                fireworks: 'Fireworks'
            },
            ro: {
                subtitle: 'Numrtoare invers pn la',
                mainTitle: `Anul Nou ${targetYear}`,
                days: 'Zile',
                hours: 'Ore',
                minutes: 'Minute',
                seconds: 'Secunde',
                happyNewYear: 'La muli ani!',
                fireworks: 'Artificii'
            }
        };

        let currentLang = localStorage.getItem('lang') || 'en';

        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('labelDays').textContent = t.days;
            document.getElementById('labelHours').textContent = t.hours;
            document.getElementById('labelMinutes').textContent = t.minutes;
            document.getElementById('labelSeconds').textContent = t.seconds;
            document.getElementById('fireworksBtn').textContent = t.fireworks;

            document.querySelectorAll('.lang-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.lang === lang);
            });

            localStorage.setItem('lang', lang);
        }

        // Language toggle
        const langToggle = document.getElementById('langToggle');
        langToggle.addEventListener('click', (e) => {
            if (e.target.classList.contains('lang-option')) {
                updateLanguage(e.target.dataset.lang);
            }
        });

        // Initialize language
        updateLanguage(currentLang);

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check for saved theme or system preference
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme) {
            html.setAttribute('data-theme', savedTheme);
        } else if (systemDark) {
            html.setAttribute('data-theme', 'dark');
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            if (newTheme === 'light') {
                html.removeAttribute('data-theme');
            } else {
                html.setAttribute('data-theme', 'dark');
            }

            localStorage.setItem('theme', newTheme);
        });

        // Countdown logic - dynamically target next January 1st
        const targetDate = new Date(targetYear, 0, 1, 0, 0, 0).getTime();

        // Handy for debugging specific dates
        // const targetDate = new Date(2025, 11, 30, 12, 49, 0).getTime();

        let hasReachedZero = false;
        let hasMusicStarted = false;

        function updateCountdown() {
            const now = new Date().getTime();
            const difference = targetDate - now;

            if (difference > 0) {
                const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((difference % (1000 * 60)) / 1000);

                document.getElementById('days').textContent = String(days).padStart(2, '0');
                document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');

                // Start climax music and fireworks sequence 4 seconds before midnight
                if (difference <= FIREWORKS_DELAY && !hasMusicStarted) {
                    hasMusicStarted = true;
                    playClimaxMusic();
                    launchFireworks();
                }
            } else {
                if (!hasReachedZero) {
                    hasReachedZero = true;
                    launchFireworks();
                }
                document.querySelector('.main-title').textContent = translations[currentLang].happyNewYear;
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
            }
        }

        // Fireworks state management
        let fireworksActive = false;
        let fireworksRocketInterval = null;
        let fireworksExplosionInterval = null;
        let fireworksStartTimeout = null;
        let fireworksEndTimeout = null;

        function stopFireworks() {
            // Clear all intervals and timeouts
            if (fireworksRocketInterval) {
                clearInterval(fireworksRocketInterval);
                fireworksRocketInterval = null;
            }
            if (fireworksExplosionInterval) {
                clearInterval(fireworksExplosionInterval);
                fireworksExplosionInterval = null;
            }
            if (fireworksStartTimeout) {
                clearTimeout(fireworksStartTimeout);
                fireworksStartTimeout = null;
            }
            if (fireworksEndTimeout) {
                clearTimeout(fireworksEndTimeout);
                fireworksEndTimeout = null;
            }

            // Clean up visual effects
            const citySkyline = document.querySelector('.city-skyline');
            const cityLightsEl = document.getElementById('cityLights');
            const nightSkyEl = document.getElementById('nightSky');
            const cityGlow = document.getElementById('cityGlow');

            citySkyline.classList.remove('lit');
            cityLightsEl.classList.remove('lit');
            nightSkyEl.classList.remove('visible');
            nightSkyEl.classList.remove('aurora-visible');
            cityGlow.classList.remove('visible');

            // Clear all firework elements
            const fireworksEl = document.getElementById('fireworks');
            fireworksEl.innerHTML = '';

            fireworksActive = false;
        }

        function launchFireworks(fromButton = false) {
            // If fireworks already running, stop them first
            if (fireworksActive) {
                stopFireworks();
            }

            fireworksActive = true;

            const fireworks = document.getElementById('fireworks');
            const citySkyline = document.querySelector('.city-skyline');
            const cityLightsEl = document.getElementById('cityLights');

            // Play climax music only if triggered by button (countdown triggers it 4s early)
            if (fromButton) {
                playClimaxMusic();
            }

            // Switch to dark mode for the fireworks show
            const html = document.documentElement;
            const wasDarkMode = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');

            // Show the night sky with moon and stars
            const nightSkyEl = document.getElementById('nightSky');
            const cityGlow = document.getElementById('cityGlow');

            nightSkyEl.classList.add('visible');
            cityGlow.classList.add('visible');

            const colors = [
                ['#ff0044', '#ff4477', '#ffaacc'],
                ['#00ff88', '#44ffaa', '#aaffdd'],
                ['#0088ff', '#44aaff', '#aaddff'],
                ['#ffaa00', '#ffcc44', '#ffeeaa'],
                ['#ff00ff', '#ff66ff', '#ffaaff'],
                ['#00ffff', '#66ffff', '#aaffff'],
                ['#ffff00', '#ffff66', '#ffffaa'],
            ];

            function getRandomColors() {
                return colors[Math.floor(Math.random() * colors.length)];
            }

            function createRocket(startX, endX, endY, delay) {
                setTimeout(() => {
                    const palette = getRandomColors();
                    const color = palette[0];
                    const duration = 0.6 + Math.random() * 0.4;
                    const travel = -(window.innerHeight - endY);

                    // Rocket
                    const rocket = document.createElement('div');
                    rocket.className = 'rocket';
                    rocket.style.left = startX + 'px';
                    rocket.style.bottom = '0';
                    rocket.style.color = color;
                    rocket.style.background = color;
                    rocket.style.setProperty('--duration', duration + 's');
                    rocket.style.setProperty('--travel', travel + 'px');
                    fireworks.appendChild(rocket);
                    setTimeout(() => rocket.remove(), duration * 1000);

                    // Rocket trail
                    const trail = document.createElement('div');
                    trail.className = 'rocket-trail';
                    trail.style.left = (startX - 1) + 'px';
                    trail.style.bottom = '0';
                    trail.style.color = color;
                    trail.style.setProperty('--duration', duration + 's');
                    trail.style.setProperty('--travel', travel + 'px');
                    fireworks.appendChild(trail);
                    setTimeout(() => trail.remove(), duration * 1000);

                    // Explosion after rocket reaches destination
                    setTimeout(() => {
                        createExplosion(endX, endY, palette);
                    }, duration * 900);
                }, delay);
            }

            function createExplosion(x, y, palette) {
                const type = Math.floor(Math.random() * 4);
                const color = palette[0];

                // Main firework burst
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.background = `radial-gradient(circle, ${palette[1]} 0%, ${color} 50%, transparent 70%)`;
                firework.style.boxShadow = `0 0 30px ${color}, 0 0 60px ${color}`;
                fireworks.appendChild(firework);
                setTimeout(() => firework.remove(), 1500);

                if (type === 0) {
                    // Classic burst with trails
                    for (let j = 0; j < 20; j++) {
                        const angle = (j / 20) * Math.PI * 2;
                        const velocity = 80 + Math.random() * 120;
                        const dx = Math.cos(angle) * velocity;
                        const dy = Math.sin(angle) * velocity;

                        const spark = document.createElement('div');
                        spark.className = 'spark';
                        spark.style.left = x + 'px';
                        spark.style.top = y + 'px';
                        spark.style.background = palette[Math.floor(Math.random() * palette.length)];
                        spark.style.color = color;
                        spark.style.setProperty('--dx', dx + 'px');
                        spark.style.setProperty('--dy', dy + 'px');
                        fireworks.appendChild(spark);
                        setTimeout(() => spark.remove(), 1400);

                        // Spark trails
                        for (let t = 0; t < 3; t++) {
                            setTimeout(() => {
                                const sparkTrail = document.createElement('div');
                                sparkTrail.className = 'spark-trail';
                                sparkTrail.style.left = x + 'px';
                                sparkTrail.style.top = y + 'px';
                                sparkTrail.style.background = palette[2];
                                sparkTrail.style.setProperty('--dx', (dx * (0.3 + t * 0.2)) + 'px');
                                sparkTrail.style.setProperty('--dy', (dy * (0.3 + t * 0.2)) + 'px');
                                fireworks.appendChild(sparkTrail);
                                setTimeout(() => sparkTrail.remove(), 800);
                            }, t * 50);
                        }
                    }
                } else if (type === 1) {
                    // Ring explosion
                    const ring = document.createElement('div');
                    ring.className = 'ring';
                    ring.style.left = x + 'px';
                    ring.style.top = y + 'px';
                    ring.style.borderColor = color;
                    ring.style.color = color;
                    fireworks.appendChild(ring);
                    setTimeout(() => ring.remove(), 1200);

                    // Inner sparks
                    for (let j = 0; j < 16; j++) {
                        const angle = (j / 16) * Math.PI * 2;
                        const velocity = 60 + Math.random() * 40;
                        const spark = document.createElement('div');
                        spark.className = 'spark';
                        spark.style.left = x + 'px';
                        spark.style.top = y + 'px';
                        spark.style.background = palette[1];
                        spark.style.color = palette[1];
                        spark.style.setProperty('--dx', Math.cos(angle) * velocity + 'px');
                        spark.style.setProperty('--dy', Math.sin(angle) * velocity + 'px');
                        fireworks.appendChild(spark);
                        setTimeout(() => spark.remove(), 1400);
                    }
                } else if (type === 2) {
                    // Starburst
                    for (let j = 0; j < 12; j++) {
                        const angle = (j / 12) * 360;
                        const star = document.createElement('div');
                        star.className = 'starburst';
                        star.style.left = x + 'px';
                        star.style.top = y + 'px';
                        star.style.background = `linear-gradient(to top, ${color}, ${palette[1]}, transparent)`;
                        star.style.setProperty('--angle', angle + 'deg');
                        fireworks.appendChild(star);
                        setTimeout(() => star.remove(), 1000);
                    }

                    // Glitter
                    for (let j = 0; j < 30; j++) {
                        setTimeout(() => {
                            const glitter = document.createElement('div');
                            glitter.className = 'glitter';
                            glitter.style.left = x + 'px';
                            glitter.style.top = y + 'px';
                            glitter.style.background = palette[Math.floor(Math.random() * palette.length)];
                            glitter.style.color = palette[2];
                            glitter.style.setProperty('--dx', (Math.random() - 0.5) * 200 + 'px');
                            glitter.style.setProperty('--dy', (Math.random() - 0.5) * 150 + 'px');
                            fireworks.appendChild(glitter);
                            setTimeout(() => glitter.remove(), 2000);
                        }, j * 30);
                    }
                } else {
                    // Double burst
                    for (let layer = 0; layer < 2; layer++) {
                        setTimeout(() => {
                            for (let j = 0; j < 16; j++) {
                                const angle = (j / 16) * Math.PI * 2 + (layer * Math.PI / 16);
                                const velocity = layer === 0 ? 100 : 60;
                                const spark = document.createElement('div');
                                spark.className = 'spark';
                                spark.style.left = x + 'px';
                                spark.style.top = y + 'px';
                                spark.style.background = palette[layer];
                                spark.style.color = palette[layer];
                                spark.style.setProperty('--dx', Math.cos(angle) * velocity + 'px');
                                spark.style.setProperty('--dy', Math.sin(angle) * velocity + 'px');
                                fireworks.appendChild(spark);
                                setTimeout(() => spark.remove(), 1400);
                            }
                        }, layer * 150);
                    }
                }
            }

            // Start fireworks after delay
            fireworksStartTimeout = setTimeout(() => {
                // Guard against stopped fireworks
                if (!fireworksActive) return;

                // Light up the city (colorful pulsating windows) and aurora when fireworks actually start
                citySkyline.classList.add('lit');
                cityLightsEl.classList.add('lit');
                nightSkyEl.classList.add('aurora-visible');

                // Continuous rockets
                fireworksRocketInterval = setInterval(() => {
                    if (!fireworksActive) return;
                    const startX = Math.random() * window.innerWidth;
                    const endX = startX + (Math.random() - 0.5) * 100;
                    const endY = 100 + Math.random() * (window.innerHeight * 0.5);
                    createRocket(startX, endX, endY, 0);
                }, 200);

                // Continuous explosions
                fireworksExplosionInterval = setInterval(() => {
                    if (!fireworksActive) return;
                    const x = Math.random() * window.innerWidth;
                    const y = 50 + Math.random() * (window.innerHeight * 0.6);
                    createExplosion(x, y, getRandomColors());
                }, 400);

                // Initial burst of rockets
                for (let i = 0; i < 15; i++) {
                    const startX = Math.random() * window.innerWidth;
                    const endX = startX + (Math.random() - 0.5) * 100;
                    const endY = 100 + Math.random() * (window.innerHeight * 0.5);
                    createRocket(startX, endX, endY, i * 100);
                }

                // End fireworks after duration
                fireworksEndTimeout = setTimeout(() => {
                    stopFireworks();
                }, FIREWORKS_DURATION);
            }, FIREWORKS_DELAY);
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);

        // Manual fireworks button
        document.getElementById('fireworksBtn').addEventListener('click', () => launchFireworks(true));
    </script>
</body>
</html>
